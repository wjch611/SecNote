[TOC]

### 一、php+mysql注入

1. mysql数据库管理模式：root型、一对一型，如果是root型存在跨库查询风险

2. mysql文件读写：

   条件：

   	1. root用户
   	1. my.ini中secury-file-priv权限设置

   操作：

   	load_file读取文件、into outfile写文件

3. 注入点：上传文件时文件名、请求包/URL中各个地方都可能存在注入点，如PHP判断IP的X-forwarded-for。扫描器的作用就是各个点都尝试，但是对于参数加密的情况就没用。

4. 盲注与增删改查：

   盲注三种：布尔、报错、延迟；其中布尔需要回显、报错需要后端代码有报错处理、延迟都可以

   增删改查：一般只有查才有回显，其他最多有容错

5. 特殊注入：二次注入、堆叠注入、带外注入

6. 二次注入：条件：1. 先插入再使用；2. 有字符转义

7. 堆叠注入：条件：1. 数据库支持多条执行；2. 后端使用例如mysqli_mutli_query的函数

8. 带外注入：解决回显问题。条件：1. root；2. 权限；

   使用：select (load_file('//',操作语句,'dnslog’)；

9. sqlmap工具使用

   1. -u使用url，-r使用数据包在里面*前表示要测试的点（推荐使用-r数据包）

   2. --proxy挂代理池跑注入点
   3. tamper模块，里面有加密模块可以解决参数加密问题
   4. --level、risk，越高测试越深入

### 二、文件上传

解析一一对应，除非可以修改解析或者存在解析漏洞

可利用：

1. JS前端校验
2. 文件头/文件类型判断

二次渲染：文件包含，插入木马，可能在渲染区内失效

工具：010 edit

阻碍：1. 目录权限；2.无视格式，解码还原；3.OSS

### 三、文件包含

漏洞成因：

	代码包含文件，被包含的文件能被执行，此文件外界可控！

黑白盒：

	黑：URL存在类似file=xxx.php、修改xxx.php为index.php看看是否可行
	
	白：观察代码中include的函数

存在包含点：

#### **本地传：**

	读取默认文件：日志文件、/etc/passwd..
	
	利用**伪协议**：file、filter、input、data
	
		读：file、filter，file需要知道完整路径
	
		写：input
	
		执行：input、data

本地文件包含实现webshell:（原理就是：**让本地文件中存在后门代码**）

1. 配合文件上传**带后门代码**的文件 -> 包含
2. 访问**带后门代码**的网页->日志文件中有后门- > 包含日志
3. nfs：两端是**权限继承**的，所以要尽量传大权限的文件过去

#### 远程传：少

### 四、文件下载漏洞

文件下载有两种操作：

1. 直连
2. 参数传递

漏洞成因在于，直连存在文件后缀解析，不是解析为下载的文件，即使替换也下载不成；而参数传递的则可以下载任何文件！

### 五、XSS

根源：

	可控输入->页面显示输出，由显示输出倒推可控输入源。有过滤就绕过，绕不过就gg，
	
	这个输出可以是前台/后台，后台危害较大

上传XSS：

	svg、pdf、flash，它们都可以在文件中插入JS代码，然后上传之后获取文件路径访问，触发JS代码
	
	flash还有另外一种思路：找到网站中的flash文件，反编译，找到可以触发JS的函数和参数

XSS项目平台：

	beef

阻碍：

	1. CSP内容共享策略：限制了内联脚本，限制了外部脚本来源，判断：响应头，请求头
	1. httponly：限制了获取cookie，判断浏览器
	1. XSS filter

遇到1,2基本gg

### 六、CSRF

条件：

1. 能构造请求数据包
2. 无拦截、拦截可绕过
3. 受害者主动触发

拦截：

1. referer，同源检测
2. csrf token

绕过：

referer:

1. 置空

   ````，
   <meta name="referrer" content="no-referrer">
   ````

2. 借用XSS、文件上传实现同源

csrf:

	1. 置空
	1. 删除
	1. 复用

### 七、SSRF

漏洞成因：服务端对客户端发送的外部地址进行请求，攻击者将外部地址换成内部地址，请求成功

阻碍：

1. 字符层面
2. 解析层面

绕过：

字符：

1. https://网站网址@内网网址
2. 短网址
3. ip编码
4. 内网ip解析

解析：

1. 使用url重定向：访问自己的vps上的一个脚本，重定向内网

伪协议：http、file、gopher

### 八、RCE

代码执行<->命令执行

各种语言的：代码执行函数、命令执行函数

阻碍：过滤

白盒审计：ctf能力

黑盒：存在命令/代码执行的功能点

无回显：1. 创建文件；2. dnslog带外判断

### 九、XXE

xml注入

数据包参数传输格式：传统、json、xml

漏洞成因：传输给服务端的xml带有恶意代码，服务端在解析时触发执行

一般XXE危害与ssrf类似，**读取文件最常见**

黑盒：

1. bp筛选数据包，观察content-type/数据包格式
2. 查看有无回显
3. 无回显，dnslog判断
4. 实体外带

### 十、反序列化

序列化：面向对象编程中，为了传输对象数据方便，将对象按照一定格式序列化进行传输

序列化与反序列化函数：

php：serialize() 、unserialize()...

python：load()、dump()..

漏洞成因：利用对象的魔术方法、构造一个在反序列化时执行恶意代码的序列化数据

挖反序列化漏洞：一般都是白盒测试

黑盒：各种语言的反序列化特征的流量分析

原生类与框架类：

挖框架类的反序列化，都是需要nday，利用一个工具，告诉框架版本，需要执行的恶意代码，就行。

框架反序列化利用链生成项目：NotSoSecure

### 十一、js逆向

在安全的作用：

1. 复现加密，爆破
2. 寻找资源

断点方法：

1. XHR断点

   ![在这里插入图片描述](E:\typora\img\web漏洞\06a82b24c258413ebe4b4949b4e4c812.png)




   在请求发送的时候断点，加密在之前，从后往前找，起点在下，终点在上

2. 文件自由断点

   ![在这里插入图片描述](E:\typora\img\web漏洞\4c1d168c36e64e2a84f679b4f0303cea.png)


3. 事件属性断点

   ![在这里插入图片描述](E:\typora\img\web漏洞\89da61ee2f9c46b58d551324407fd981.png)




BP结合自由加密：

![在这里插入图片描述](E:\typora\img\web漏洞\d912028ac1b0440bba4c80f95d23eba3.png)



阻碍：

1. 反调试
2. 关键加解密代码混淆/加密

绕过：

反调试：

 1. 禁止F12，先开一个新窗口开F12,然后再拖目标网页到这个窗口

 2. 本地覆盖法：

    1. 先禁用所有断点

       ![在这里插入图片描述](E:\typora\img\web漏洞\a3d99d7ae385424287f601aa8fd98006.png)


    2. 寻找反调试的代码文件

   ![在这里插入图片描述](E:\typora\img\web漏洞\3e56347cfe7149ed8ff68b408f54051d.png)

       在覆盖中添加，然后注释掉反调试部分

关键代码混淆：

1. 获取到加密类型
2. 解密网址：JSDEC、github上搜

**JS逆向插件：**

	tampermonkey+hook脚本 -> 获取js中加密信息->控制台显示
	
	脚本地址：
	https://github.com/Captain0X/hacker_tools

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/f2b6548f830546fda59050247e2d306e.png#pic_center)


### 十二、JAVA SQL

黑盒与php一样

白盒：

判断数据库驱动：JDBC、Mybatis，其中每种都有写法错误照成的漏洞

java白盒审计入门项目：

![在这里插入图片描述](E:\typora\img\web漏洞\4d700da8d4944d0293df0c4c646127f0.png)


### 十三、SSTI

服务端模板注入：可控参数输入框架，页面改变

SSTI结合RCE，各种语言的模板引擎都支持tags输入参数代码执行

![在这里插入图片描述](E:\typora\img\web漏洞\1bf27e71753e4f7291c60c1e0a07a2e1.png)


黑盒：类似XSS，输入导致输出，可能是注入点

发现注入点：使用**SSTIMap**工具

### 十四、常见的RCE

白盒中，各种语言中触发代码/命令执行的函数，传入参数可控导致！

### 十五、JDNI

java语言中的一种服务，支持服务端远程执行自定义的class文件，主要协议：rmi、ldap

只在白盒代码审计中才能发现，常用于协助其他漏洞

rmi、ladp有java版本限制，网上有高版本绕过工具

### 十六、JAVA 组件漏洞

都配合JDNI

Log4J、Xstream、JackJson、FastJson、shiro

白盒中：

黑盒中：

特征：

强特征：shiro，cookie中存在remeber-me

作用分析注入点：Log4j日志管理组件、Xstream XML<->对象、JackJson/FastJson json<->对象、shiro登录验证

### 十七、JAVA Spring boot信息泄露

主要是spring boot中的actuator导致的泄露，重要内容有env、hashdump

BP插件：APIKit发现信息泄露

HashDump_tool：分析hashdump文件

### 十八、JAVA swagger

swagger会泄露网站的大部分api接口

黑盒测试：

1. APIKit
2. 直接访问/swagger-ui.html

工具联动：

1. postman批量跑API发包
2. 代理挂上BP
3. BP再挂上可以代理的漏扫工具（Xray）

### 十九、JWT

绕过：

1. 空加密
2. 加密算法是HS开头的，对称加密可爆破，jwt_tool
3. 非对称加密，获取源码/信息泄露..获取加密钥

### 二十、反编译

.net：dll、java：jar/class、python：pyc

### 二一、Fuzz REC

intruder：

1. 猜目录/文件名
2. 猜参数
3. 猜参数名

![在这里插入图片描述](E:\typora\img\web漏洞\5815c1d2cc4c40fbb8c3747b45994f7b.png)


### 二二、隐私合规

appscan+真机root项目+实时获取最新的app上架信息

### 二三、消耗资源拒绝服务

1. 服务解析图片资源，客户端参数控制图片/验证码大小
2. 服务端解压：发送压缩包炸弹：无限循环的zip
3. BP再挂上可以代理的漏扫工具（Xray）

### 十九、JWT

绕过：

1. 空加密
2. 加密算法是HS开头的，对称加密可爆破，jwt_tool
3. 非对称加密，获取源码/信息泄露..获取加密钥

### 二十、反编译

.net：dll、java：jar/class、python：pyc

### 二一、Fuzz REC

intruder：

1. 猜目录/文件名
2. 猜参数
3. 猜参数名

[外链图片转存中...(img-yKel7tXz-1742107531799)]

### 二二、隐私合规

appscan+真机root项目+实时获取最新的app上架信息

### 二三、消耗资源拒绝服务

1. 服务解析图片资源，客户端参数控制图片/验证码大小
2. 服务端解压：发送压缩包炸弹：无限循环的zip