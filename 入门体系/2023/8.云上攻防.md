### 存储桶：

域名规则：桶名称.oss-cn-地域.云厂商.com（一个云厂商的桶名称是具有唯一性的）

漏洞：

1. 桶劫持

   存储桶可以CMANE解析到另外一个域名，相当与在存储桶上搭建网站

   如果这个桶被删除了，但是域名没有解除解析，那么我们可以直接去对应厂商重新创建这个桶，就劫持了

   判断：

   1. 直接访问域名出现：NoSuchBucket
   2. 直接ping域名出现：存储桶规则的域名
   3. 根据域名->IP，那么根据域名->cname域名看看是不是存储的域名（可以作为一个项目）

2. 泄露key



### 获取临时凭证（KEY）：

一个云账户（超管账户）下面可以申请多个 云服务器/云数据库/存储桶，存在一个配置：给超管账户下分配子账户（每个子账户的权限最少能管理同类云服务）

漏洞成因：

1. 判断服务器是云服务器
2. 这个云服务器上的账户被分配了权限
3. 在这个云服务器上有一定的权限可以执行读取KEY的命令（可以通过其他漏洞：RCE、**回显SSRF**等）
4. 直接拿下key、CF整起

读取用户凭证的地址，各个厂商不同，可以去官网查看！



### Docker:

容器虚拟的是操作系统，虚拟机虚拟的是计算器硬件环境。

容器技术提供的镜像是一种/多种服务，而这种服务是运行在虚拟的操作系统中。

容器存在的意义在于，避免了搭建服务环境配置的繁琐。

前渗透：

1. 传统打点获取权限

后渗透：

1. 判断是否在容器中

2. 在：是否**特权启动容器、容器挂载**（搭建者需要引入容器外其他的服务）

3. 是：是否高权限（需要高权限，java/jsp获取权限默认是高，其他语言打点获取的权限还需要提升才能逃逸）

   1. 是：逃逸

   	2. 否：权限提升，再逃逸

4. 否：尝试docker本身漏洞（判断docker的版本，找版本区间内的CVE）、系统漏洞

逃逸项目：

![在这里插入图片描述](E:\typora\img\云上攻防\59768d9bc47b46cca689570bba81e975.png)


1. 自动化识别当前环境存在哪些逃逸漏洞

2. 自动化执行对应逃逸漏洞

3. 指定执行逃逸漏洞

   1. 反弹shell

   2. 获取到root挂载目录

      ![在这里插入图片描述](E:\typora\img\云上攻防\e84896f871c94f07b1a5e86856c2b7f8.png)


      进一步获取反弹shell



### Kubernetes:

是亚马逊开源的针对管理多个服务主机上的容器的技术，分master、node节点

最大目标是拿下master：

1. master本身的攻击点
   1. API Server
   2. etcd
2. 通过node横向移动
   1. kubelet
   2. kube-proxy
   3. 镜像服务本身打点进去->容器逃逸到node
3. 直接攻击云管理平台

![在这里插入图片描述](E:\typora\img\云上攻防\9445b04f15fe4032bc01e8cd9d67a2ba.png)


参考链接：

https://mp.weixin.qq.com/s/yQoqozJgP8F-ad24xgzIPw

https://mp.weixin.qq.com/s/QEuQa0KVwykrMzOPdgEHMQ